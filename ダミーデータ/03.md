-- ダミーデータ生成用ストアドプロシージャ
-- Google Cloud SQL (SQL Server) 用

CREATE OR ALTER PROCEDURE sp_GenerateContainerDummyData
AS
BEGIN
    SET NOCOUNT ON;
    
    -- 既存の変数を削除
    DECLARE @Counter INT = 1;
    DECLARE @ContainerId CHAR(16);
    DECLARE @ContainerName NVARCHAR(30);
    
    -- 既存のダミーデータを削除（必要に応じて）
    -- DELETE FROM [dbo].[Container] WHERE ContainerId LIKE 'DUMMY_%';
    
    PRINT 'Containerテーブルのダミーデータ生成を開始します...';
    
    WHILE @Counter <= 81
    BEGIN
        -- ContainerIdを生成（16桁、DUMMY_で始まる）
        SET @ContainerId = 'DUMMY_' + RIGHT('0000000000' + CAST(@Counter AS VARCHAR), 10);
        
        -- ContainerNameを生成
        SET @ContainerName = 'Container_' + CAST(@Counter AS VARCHAR);
        
        INSERT INTO [dbo].[Container] (
            [BatchComments],
            [BatchId],
            [BatchStatus],
            [BillOfProcessId],
            [BinSize],
            [BOMId],
            [CDOTypeId],
            [ChangeCount],
            [ChildCount],
            [ConsumingOrder],
            [ContainerComments],
            [ContainerId],
            [ContainerName],
            [ContainerStartGUID],
            [CurrentHoldCount],
            [CurrentStatusId],
            [CurrentThruputChildCount],
            [CurrentThruputQty],
            [CurrentThruputQty2],
            [CurrentThruputUnitCount],
            [CustomerId],
            [DateCode],
            [Description],
            [DetailId],
            [Direction],
            [DueDate],
            [DueDateGMT],
            [ExpirationDate],
            [ExpirationDateGMT],
            [FactoryStartDate],
            [FactoryStartDateGMT],
            [FactoryStartQty],
            [FactoryStartQty2],
            [FactoryStartUOM2Id],
            [FactoryStartUOMId],
            [HoldReasonId],
            [InQualityControl],
            [IssuedToContainerId],
            [LastActivityDate],
            [LastActivityDateGMT],
            [LastCarrierId],
            [LastCompletionDate],
            [LastCompletionDateGMT],
            [LastRevTxnId],
            [LeadFree],
            [LevelId],
            [MasterRecipeId],
            [MfgOrderId],
            [MfgPartNumber],
            [NickName],
            [OnHoldDate],
            [OriginalContainerId],
            [OriginalFactoryId],
            [OriginalQty],
            [OriginalQty2],
            [OriginalStartDate],
            [OriginalStartDateGMT],
            [OriginalUOM2Id],
            [OriginalUOMId],
            [OwnerId],
            [ParentContainerId],
            [PlannedProductId],
            [PlannedQty],
            [PlannedQty2],
            [PlannedQtyUOM2Id],
            [PlannedQtyUOMId],
            [PlannedStartDate],
            [PlannedStartDateGMT],
            [PriorityCodeId],
            [ProductId],
            [ProductionComplete],
            [Qty],
            [Qty2],
            [RelativePriority],
            [RequestDate],
            [RequestDateGMT],
            [SalesOrderId],
            [SamplingLotId],
            [SamplingPassed],
            [SamplingRequired],
            [ShapeName],
            [SPCChartSaveOptionsEnumId],
            [SpecStatusId],
            [SplitFromId],
            [StartParentContainerId],
            [StartReasonId],
            [Status],
            [Supplier],
            [SupplyFromName],
            [SupplyFromType],
            [ThisContainerLost],
            [ThruputAdjustmentChildCount],
            [ThruputAdjustmentQty],
            [ThruputAdjustmentQty2],
            [ThruputAdjustmentUnitCount],
            [UnitCount],
            [UOM2Id],
            [UOMId],
            [VendorItemId],
            [WIPMsgDefMgrId],
            [bpCalculateQtyRequired],
            [DeviceIdentifierId],
            [isAssociatedCarrierId],
            [isAutoStart],
            [isCarrier],
            [isCarrierSlot],
            [isFailed],
            [isHoldReasonName],
            [isInventoryLocationId],
            [isMaterialManageEnabled],
            [isProductName],
            [isProductRevision],
            [isRepairedDefectCount],
            [ManufacturingDate],
            [ManufacturingDateGMT],
            [ProductionIdentifier],
            [UDI]
        )
        VALUES (
            'サンプルバッチコメント',                                           -- BatchComments (同一)
            'BATCH_0000000001',                                               -- BatchId (同一)
            1,                                                                -- BatchStatus (同一)
            'BOP_0000000001',                                                 -- BillOfProcessId (同一)
            'StandardBinSize',                                                -- BinSize (同一)
            'BOM_0000000001',                                                 -- BOMId (同一)
            1,                                                                -- CDOTypeId (同一)
            5,                                                                -- ChangeCount (同一)
            10,                                                               -- ChildCount (同一)
            'StandardOrder',                                                  -- ConsumingOrder (同一)
            'サンプルコンテナコメント',                                           -- ContainerComments (同一)
            @ContainerId,                                                     -- ContainerId (一意)
            @ContainerName,                                                   -- ContainerName (一意)
            NEWID(),                                                          -- ContainerStartGUID (一意)
            0,                                                                -- CurrentHoldCount (同一)
            'STATUS_0000000001',                                              -- CurrentStatusId (同一)
            5,                                                                -- CurrentThruputChildCount (同一)
            100.0,                                                            -- CurrentThruputQty (同一)
            110.0,                                                            -- CurrentThruputQty2 (同一)
            8,                                                                -- CurrentThruputUnitCount (同一)
            'CUST_0000000001',                                                -- CustomerId (同一)
            'DC202501',                                                       -- DateCode (同一)
            'サンプル製品説明',                                                 -- Description (同一)
            'DETAIL_000000001',                                               -- DetailId (同一)
            1,                                                                -- Direction (同一)
            '2025-01-15 10:00:00',                                            -- DueDate (同一)
            '2025-01-15 19:00:00',                                            -- DueDateGMT (同一)
            '2025-02-15 10:00:00',                                            -- ExpirationDate (同一)
            '2025-02-15 19:00:00',                                            -- ExpirationDateGMT (同一)
            '2025-01-01 08:00:00',                                            -- FactoryStartDate (同一)
            '2025-01-01 17:00:00',                                            -- FactoryStartDateGMT (同一)
            95.0,                                                             -- FactoryStartQty (同一)
            104.5,                                                            -- FactoryStartQty2 (同一)
            'UOM2_0000000001',                                                -- FactoryStartUOM2Id (同一)
            'UOM_00000000001',                                                -- FactoryStartUOMId (同一)
            NULL,                                                             -- HoldReasonId (同一)
            0,                                                                -- InQualityControl (同一)
            NULL,                                                             -- IssuedToContainerId (同一)
            GETDATE(),                                                        -- LastActivityDate (同一)
            DATEADD(HOUR, 9, GETDATE()),                                      -- LastActivityDateGMT (同一)
            'CARRIER_00000001',                                               -- LastCarrierId (同一)
            '2025-01-10 15:00:00',                                            -- LastCompletionDate (同一)
            '2025-01-11 00:00:00',                                            -- LastCompletionDateGMT (同一)
            'REVTXN_00000001',                                                -- LastRevTxnId (同一)
            1,                                                                -- LeadFree (同一)
            'LEVEL_0000000001',                                               -- LevelId (同一)
            'RECIPE_000000001',                                               -- MasterRecipeId (同一)
            'MFGORDER_00000001',                                              -- MfgOrderId (同一)
            'MPN-000001',                                                     -- MfgPartNumber (同一)
            'サンプルニックネーム',                                             -- NickName (同一)
            NULL,                                                             -- OnHoldDate (同一)
            NULL,                                                             -- OriginalContainerId (同一)
            'FACTORY_00000001',                                               -- OriginalFactoryId (同一)
            100.0,                                                            -- OriginalQty (同一)
            110.0,                                                            -- OriginalQty2 (同一)
            '2025-01-01 08:00:00',                                            -- OriginalStartDate (同一)
            '2025-01-01 17:00:00',                                            -- OriginalStartDateGMT (同一)
            'OUOM2_000000001',                                                -- OriginalUOM2Id (同一)
            'OUOM_0000000001',                                                -- OriginalUOMId (同一)
            'OWNER_0000000001',                                               -- OwnerId (同一)
            NULL,                                                             -- ParentContainerId (同一)
            'PRODUCT_00000001',                                               -- PlannedProductId (同一)
            105.0,                                                            -- PlannedQty (同一)
            115.5,                                                            -- PlannedQty2 (同一)
            'PUOM2_000000001',                                                -- PlannedQtyUOM2Id (同一)
            'PUOM_0000000001',                                                -- PlannedQtyUOMId (同一)
            '2025-01-01 08:00:00',                                            -- PlannedStartDate (同一)
            '2025-01-01 17:00:00',                                            -- PlannedStartDateGMT (同一)
            'PRIORITY_000001',                                                -- PriorityCodeId (同一)
            'PROD_00000000001',                                               -- ProductId (同一)
            0,                                                                -- ProductionComplete (同一)
            100.0,                                                            -- Qty (同一)
            110.0,                                                            -- Qty2 (同一)
            50,                                                               -- RelativePriority (同一)
            '2024-12-01 08:00:00',                                            -- RequestDate (同一)
            '2024-12-01 17:00:00',                                            -- RequestDateGMT (同一)
            'SALES_0000000001',                                               -- SalesOrderId (同一)
            NULL,                                                             -- SamplingLotId (同一)
            1,                                                                -- SamplingPassed (同一)
            0,                                                                -- SamplingRequired (同一)
            'StandardShape',                                                  -- ShapeName (同一)
            'SPCCHART_000001',                                                -- SPCChartSaveOptionsEnumId (同一)
            'SPEC_00000000001',                                               -- SpecStatusId (同一)
            NULL,                                                             -- SplitFromId (同一)
            NULL,                                                             -- StartParentContainerId (同一)
            'REASON_0000000001',                                              -- StartReasonId (同一)
            1,                                                                -- Status (同一)
            'サンプルサプライヤー',                                             -- Supplier (同一)
            'StandardSupplyFrom',                                             -- SupplyFromName (同一)
            'StandardType',                                                   -- SupplyFromType (同一)
            0,                                                                -- ThisContainerLost (同一)
            2,                                                                -- ThruputAdjustmentChildCount (同一)
            2.0,                                                              -- ThruputAdjustmentQty (同一)
            2.2,                                                              -- ThruputAdjustmentQty2 (同一)
            1,                                                                -- ThruputAdjustmentUnitCount (同一)
            10,                                                               -- UnitCount (同一)
            'UOM2_0000000001',                                                -- UOM2Id (同一)
            'UOM_00000000001',                                                -- UOMId (同一)
            'VENDOR_00000001',                                                -- VendorItemId (同一)
            'WIPMSG_00000001',                                                -- WIPMsgDefMgrId (同一)
            1,                                                                -- bpCalculateQtyRequired (同一)
            'DEVICE_00000001',                                                -- DeviceIdentifierId (同一)
            NULL,                                                             -- isAssociatedCarrierId (同一)
            1,                                                                -- isAutoStart (同一)
            0,                                                                -- isCarrier (同一)
            NULL,                                                             -- isCarrierSlot (同一)
            0,                                                                -- isFailed (同一)
            NULL,                                                             -- isHoldReasonName (同一)
            'LOCATION_0000001',                                               -- isInventoryLocationId (同一)
            1,                                                                -- isMaterialManageEnabled (同一)
            'サンプル製品名',                                                   -- isProductName (同一)
            'Rev01',                                                          -- isProductRevision (同一)
            0,                                                                -- isRepairedDefectCount (同一)
            '2025-01-01 08:00:00',                                            -- ManufacturingDate (同一)
            '2025-01-01 17:00:00',                                            -- ManufacturingDateGMT (同一)
            'PID-000000000001',                                               -- ProductionIdentifier (同一)
            'UDI-000000000000000001'                                          -- UDI (同一)
        );
        
        SET @Counter = @Counter + 1;
        
        -- 進捗表示（10件ごと）
        IF (@Counter - 1) % 10 = 0
        BEGIN
            PRINT CAST(@Counter - 1 AS VARCHAR) + ' 件のデータを生成しました...';
        END
    END;
    
    PRINT '完了: Container テーブルに ' + CAST(@Counter - 1 AS VARCHAR) + ' 件のダミーデータを生成しました。';
    
    -- 生成されたデータの確認用クエリ
    SELECT 
        COUNT(*) as 総件数,
        SUM(CASE WHEN ProductionComplete = 1 THEN 1 ELSE 0 END) as 生産完了件数,
        SUM(CASE WHEN isFailed = 1 THEN 1 ELSE 0 END) as 失敗件数,
        SUM(CASE WHEN ThisContainerLost = 1 THEN 1 ELSE 0 END) as 紛失件数,
        AVG(Qty) as 平均数量,
        MIN(FactoryStartDate) as 最古の開始日,
        MAX(FactoryStartDate) as 最新の開始日
    FROM [dbo].[Container] 
    WHERE ContainerId LIKE 'DUMMY_%';
    
END;